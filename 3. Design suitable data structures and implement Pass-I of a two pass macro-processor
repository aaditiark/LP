3. Design suitable data structures and implement Pass-I of a two pass macro-processor

import re
from collections import OrderedDict

def read_lines():
    print("Enter macro program lines, end with END:")
    lines = []
    while True:
        l = input().rstrip()
        lines.append(l)
        if l.strip().upper() == 'END':
            break
    return lines

def pass1_macro(lines):
    MNT = OrderedDict()      # name -> {'mdt': index, 'argc': n}
    MDT = []                 # list of definition lines (1-based index shown)
    ALA = OrderedDict()      # name -> [formal1, formal2, ...]
    i = 0
    while i < len(lines):
        line = lines[i].strip()
        if line.upper() == 'MACRO':
            i += 1
            header = lines[i].strip() if i < len(lines) else ''
            parts = [p for p in re.split(r'[\s,]+', header) if p]
            if not parts:
                i += 1
                continue
            mname = parts[0]
            formals = []
            if len(parts) > 1:
                raw = ' '.join(parts[1:])
                raw = raw.replace(' ', '')
                formals = [f.lstrip('&') for f in raw.split(',') if f]
            ALA[mname] = formals[:]
            MNT[mname] = {'mdt': len(MDT)+1, 'argc': len(formals)}
            i += 1
            while i < len(lines):
                body = lines[i].rstrip()
                if body.strip().upper() == 'MEND':
                    MDT.append('MEND')
                    i += 1
                    break
                out = body
                for idx, fm in enumerate(formals, 1):
                    pattern = re.compile(r'(&?'+re.escape(fm)+r')\b')
                    out = pattern.sub(f'(P,{idx})', out)
                MDT.append(out)
                i += 1
            continue
        i += 1
    return MNT, MDT, ALA

def show(MNT, MDT, ALA):
    print("\nMNT (Macro Name Table):")
    print("Name\tMDTIndex\tArgCount")
    for name, v in MNT.items():
        print(f"{name}\t{v['mdt']}\t{v['argc']}")
    print("\nMDT (Macro Definition Table):")
    print("Index\tDefinition")
    for idx, line in enumerate(MDT, 1):
        print(f"{idx}\t{line}")
    print("\nALA (Argument List Array):")
    for name, args in ALA.items():
        print(f"{name}\t{','.join(args) if args else '-'}")

if __name__ == "__main__":
    lines = read_lines()
    MNT, MDT, ALA = pass1_macro(lines)
    show(MNT, MDT, ALA)

INPUT
MACRO
INCR &A,&B
MOVER AREG,&A
ADD AREG,&B
MOVEM AREG,&A
MEND
START 100
INCR A,B
END




